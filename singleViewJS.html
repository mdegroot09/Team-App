<script>

function showView(data){
  // clear previous values
  clearSingleView()
  
  // hide inputs if previously shown
  showSingleViewData()
  
  var singleView = document.getElementsByClassName('singleView')[0]
  var singleViewQuit = document.getElementsByClassName('singleViewQuit')[0]
  singleView.style.display = 'flex'
  singleViewQuit.style.display = 'block'
  
  document.getElementById('singleBuyerName').innerHTML = data.buyerName
  
  if (data.email != 'undefined' && data.email != 'null'){
    setInnerHTML('singleEmail', '<a href="mailto:' + data.email + '">' + data.email + '</a>', 'Email: ')
  }
  if (data.dynamicsLink != 'undefined' && data.dynamicsLink != 'null'){
    setInnerHTML('singleDynamicsLink', '<a href="' + data.dynamicsLink + '">' + data.dynamicsLink + '</a>', 'Dynamics: ')
  }
  if (data.toolsLink != 'undefined' && data.toolsLink != 'null'){
    setInnerHTML('singleToolsLink', '<a href="' + data.toolsLink + '">' + data.toolsLink + '</a>', 'Tools: ')
  }
  if (data.stage == 'UC' || data.stage == 'Closed'){
    setInnerHTML('singleUnderContractDate', data.underContractDate, 'UC Date: ', true)
    setInnerHTML('singleDueDiligenceDate', data.dueDiligenceDate, 'Due Diligence Deadline: ', true)
    setInnerHTML('singleFinancingDate', data.financingDate, 'F&A Deadline: ', true)
    setInnerHTML('singleSettlementDate', data.settlementDate, 'Settlement Deadline: ', true)
    
    if (data.stage == 'UC'){
      setInnerHTML('singleClosedDate', data.closedDate, 'Closed Date: ', true)
    }
  }
  
  // if user is on listing side, show stage text without dropdown
  var user = getLocalUserInfo()
  if (user.userType.includes('Listing')){
    setInnerHTML('singleStageText', data.stage, 'Stage: ')
  }
  
  setInnerHTML('singlePhone', data.phone, 'Phone: ')
  setInnerHTML('singleListingAgent', data.listingAgent, 'Referrer: ')
  // setInnerHTML('singleCommission', data.commission, 'Commission: ')
  setInnerHTML('singleSource', data.source, 'Source: ')
  setInnerHTML('singleExpectedClose', data.expectedClose, 'Expected Close: ', true)
  setInnerHTML('singleBuyerAgent', data.buyerAgent, 'Buyer Agent: ')
  setInnerHTML('singleStatus', data.status, 'Status: ')
  setInnerHTML('singleLossReason', data.lossReason, 'Loss Reason: ')
  // setInnerHTML('singleListingAgentManager', data.listingAgentManager, 'Referrer Manager: ')
  setInnerHTML('singleTags', data.tags, 'Tags: ')
  setInnerHTML('singleAddress', data.address, 'Address: ')
  setInnerHTML('singleListedPrice', data.listedPrice, 'Listed Price: ')
  setInnerHTML('singleDateCreated', data.dateCreated, 'Date Created: ', true)
  setInnerHTML('singleNotes', data.notes, 'Notes: ')
  setInnerHTML('singleLastUpdated', data.lastUpdated, 'Last Updated: ', true)
  setInnerHTML('singleCommissionDate', data.commissionDate, 'Commission Date: ', true)
  
  updateSingleViewInputs(data)
}

function setInnerHTML(id, val, title, isDate = false){
  var e = document.getElementById(id)
  if (val != 'undefined' && val != 'null' && val != 'NaN'){
    e.innerHTML = title + val
    e.style.display = 'block'
    e.style.margin = '5px'
  }
  else {
    // e.innerHTML = ''
  }
  
  // if value is a date, format view
  if (isDate){
    var date = new Date(Number(val))
    var dateStr = convertDate(date)
    dateStr = dateStr.split(' 0:00')[0]
    e.innerHTML = title + dateStr
  }
}

function quitView(){
  document.getElementsByClassName('singleView')[0].style.display = 'none'
  document.getElementsByClassName('singleViewQuit')[0].style.display = 'none'
}

function clearSingleView(){
  document.getElementById('singleBuyerName').innerHTML = ''
  document.getElementById('singlePhone').innerHTML = ''
  document.getElementById('singleEmail').innerHTML = ''
  document.getElementById('singleDynamicsLink').innerHTML = ''
  document.getElementById('singleToolsLink').innerHTML = ''
  document.getElementById('singleListingAgent').innerHTML = ''
  document.getElementById('singleStageText').innerHTML = ''
  // setInnerHTML('singleCommission', data.commission, 'Commission: ')
  document.getElementById('singleSource').innerHTML = ''
  document.getElementById('singleExpectedClose').innerHTML = ''
  document.getElementById('singleBuyerAgent').innerHTML = ''
  document.getElementById('singleStatus').innerHTML = ''
  document.getElementById('singleLossReason').innerHTML = ''
  document.getElementById('singleListingAgentManager').innerHTML = ''
  document.getElementById('singleTags').innerHTML = ''
  document.getElementById('singleAddress').innerHTML = ''
  document.getElementById('singleListedPrice').innerHTML = ''
  document.getElementById('singleUnderContractDate').innerHTML = ''
  document.getElementById('singleDueDiligenceDate').innerHTML = ''
  document.getElementById('singleFinancingDate').innerHTML = ''
  document.getElementById('singleSettlementDate').innerHTML = ''
  document.getElementById('singleClosedDate').innerHTML = ''
  document.getElementById('singleDateCreated').innerHTML = ''
  document.getElementById('singleNotes').innerHTML = ''
  document.getElementById('singleLastUpdated').innerHTML = ''
  document.getElementById('singleCommissionDate').innerHTML = ''
}

function showSingleViewInputs(){
  // hide data 
  document.getElementsByClassName('singleViewEdit')[0].style.display = 'none'
  document.getElementsByClassName('singleViewHeader')[0].style.display = 'none'
  document.getElementById('singleViewData').style.display = 'none'
  
  // show inputs
  document.getElementsByClassName('singleViewHeader')[1].style.display = 'flex'
  document.getElementById('singleViewInputs').style.display = 'flex'
}

function showSingleViewData(){
  // exit view if "esc" key is pressed
  document.addEventListener("keydown", function(e) {
    if(e.which == 27){
      quitView()
    }
  })
 
  // show data
  var user = getLocalUserInfo()
  if (user.userType == 'Admin' || user.userType == 'Buyer Agent'){
    document.getElementsByClassName('singleViewEdit')[0].style.display = 'block'
  }
  document.getElementsByClassName('singleViewHeader')[0].style.display = 'block'
  document.getElementById('singleViewData').style.display = 'block'
  
  // hide inputs
  document.getElementsByClassName('singleViewHeader')[1].style.display = 'none'
  document.getElementById('singleViewInputs').style.display = 'none'
}

function updateSingleViewInputs(data){
  document.getElementById("singleBuyerNameInput").value = checkTruthy(data.buyerName)
  document.getElementById("singlePhoneInput").value = checkTruthy(data.phone)
  document.getElementById("singleEmailInput").value = checkTruthy(data.email)
  document.getElementById("singleDynamicsLinkInput").value = checkTruthy(data.dynamicsLink)
  document.getElementById("singleToolsLinkInput").value = checkTruthy(data.toolsLink)
  document.getElementById("singleListingAgentInput").value = checkTruthy(data.listingAgent)
  document.getElementById("singleStageInput").value = checkTruthy(data.stage)
  document.getElementById("singleCommissionInput").value = checkTruthy(data.commission)
  document.getElementById("singleSourceInput").value = checkTruthy(data.source)
  document.getElementById("singleExpectedCloseInput").value = checkTruthy(data.expectedClose, true)
  document.getElementById("singleBuyerAgentInput").value = checkTruthy(data.buyerAgent)
  document.getElementById("singleStatusInput").value = checkTruthy(data.status)
  document.getElementById("singleLossReasonInput").value = checkTruthy(data.lossReason)
  // document.getElementById("singleListingAgentManagerInput").value = checkTruthy(data.listingAgentManager)
  document.getElementById("singleTagsInput").value = checkTruthy(data.tags)
  document.getElementById("singleAddressInput").value = checkTruthy(data.address)
  document.getElementById("singleListedPriceInput").value = checkTruthy(data.listedPrice)
  document.getElementById("singleUnderContractDateInput").value = checkTruthy(data.underContractDate, true)
  document.getElementById("singleDueDiligenceDateInput").value = checkTruthy(data.dueDiligenceDate, true)
  document.getElementById("singleFinancingDateInput").value = checkTruthy(data.financingDate, true)
  document.getElementById("singleSettlementDateInput").value = checkTruthy(data.settlementDate, true)
  document.getElementById("singleClosedDateInput").value = checkTruthy(data.closedDate, true)
  // document.getElementById("singleDateCreatedInput").value = checkTruthy(data.dateCreated, true)
  document.getElementById("singleNotesInput").value = checkTruthy(data.notes)
  // document.getElementById("singleLastUpdatedInput").value = checkTruthy(data.lastUpdated, true)
  // document.getElementById("singleCommissionDateInput").value = checkTruthy(data.commissionDate, true)
}

function checkTruthy(val, isDate = false){
  if (val != '' && val != 'undefined' && val != 'null' && val != 'NaN'){
    if (isDate){
      var date = new Date(Number(val))
      var dateStr = convertDate(date)
      return dateStr.split(' 0:00')[0]
    }
    return val
  }
  else {
    return ''
  }
}

</script>