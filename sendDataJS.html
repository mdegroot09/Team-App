<script>

function submit(){
  var buyerName = document.getElementById('nameReferral').value
  var buyerPhone = document.getElementById('phoneReferral').value
  var buyerEmail = document.getElementById('emailReferral').value
  var street = document.getElementById('streetReferral').value
  var city = document.getElementById('cityReferral').value
  var zip = document.getElementById('zipReferral').value
  var notes = document.getElementById('notesReferral').value
  var typeE = document.getElementById('referralType')
  var type = typeE.options[typeE.selectedIndex].text
  var sourceE = document.getElementsByClassName('sourceClass')[0]
  var source = sourceE.options[sourceE.selectedIndex].text
  
  if (source === 'choose...') {
    source = ''
  }
  
  var userName = document.user.userName
  var userType = document.user.userType
  
  var details = {
    buyerName: buyerName,
    buyerPhone: buyerPhone,
    buyerEmail: buyerEmail,
    street: street,
    city: city,
    zip: zip,
    notes: notes,
    type: type,
    source: source,
    referringName: userName,
    referringType: userType
  }
  
//  checkForBlanks(details)
  runSubmitReferral(details)
}

function updateSourceStyling(){
  var typeE = document.getElementById('referralType')
  var type = typeE.options[typeE.selectedIndex].text
  var e = document.getElementsByClassName('sourceClass')[0]
  
  // enable source dropdown
  if (type !== 'choose...' && type !== 'Homie Seller' && type !== 'SOI'){
    e.removeAttribute("id")
    e.disabled = false
  }
  
  // disable source dropdown
  else {
    e.setAttribute("id", "source")
    e.disabled = true
  }
}

function runSubmitReferral(details){

  // show loading view
  showLoading(true) 
  
  // Get user info
  google.script.run  
  // if successful, display the data 
  .withSuccessHandler(function(res){
    showMessage(true, 'Success. Your referral has been sent to ' + res + '.')
    clearValues() // clear values and dropdowns
    load() // reload data to bring in updated info
  })
  // if error
  .withFailureHandler(function(err){
    console.error("error occured", err);
    showMessage(false, 'Referral failed. Please try again.')
  })
  .submitReferral(details)
}

function clearValues(){

  // reset values to empty strings
  document.getElementById('nameReferral').value = ''
  document.getElementById('phoneReferral').value = ''
  document.getElementById('emailReferral').value = ''
  document.getElementById('streetReferral').value = ''
  document.getElementById('cityReferral').value = ''
  document.getElementById('zipReferral').value = ''
  document.getElementById('notesReferral').value = ''
  
  // reset dropdowns to default
  document.getElementById('referralType').value = 0
  document.getElementsByClassName('sourceClass')[0].value = 0
  
  // reset display of sourceElements to 'none'
  var e = document.getElementsByClassName('sourceElements')
  for (var i = 0; i < e.length; i++){
    e[i].style.display = 'none'
  }
}

</script>