<script>

function submit(){
  var buyerName = document.getElementById('nameReferral').value
  var buyerPhone = document.getElementById('phoneReferral').value
  var buyerEmail = document.getElementById('emailReferral').value
  var street = document.getElementById('streetReferral').value
  var city = document.getElementById('cityReferral').value
  var zip = document.getElementById('zipReferral').value
  var notes = document.getElementById('notesReferral').value
  var typeE = document.getElementById('referralType')
  var type = typeE.options[typeE.selectedIndex].text
  var sourceE, source
  
  if (type !== 'choose...' && type !== 'Homie Seller'){
    sourceE = document.getElementById('source')
    source = sourceE.options[sourceE.selectedIndex].text
  }
  
//  checkForBlanks(buyerName, buyerPhone, buyerEmail, street, city, zip, notes, type, source)
  runSubmitReferral(buyerName, buyerPhone, buyerEmail, street, city, zip, notes, type, source)
}

function displaySource(){
  var typeE = document.getElementById('referralType')
  var type = typeE.options[typeE.selectedIndex].text
  var e = document.getElementsByClassName('sourceElements')
  
  if (type !== 'choose...' && type !== 'Homie Seller'){
    for (var i = 0; i < e.length; i++){
      e[i].style.display = 'block'
    }
  }
  
  else {
    for (var i = 0; i < e.length; i++){
      e[i].style.display = 'none'
    }
  }
}

function runSubmitReferral(buyerName, buyerPhone, buyerEmail, street, city, zip, notes, type, source){

  // show loading view
  showLoading(true) 
  
  // Get user info
  google.script.run  
  // if successful, display the data 
  .withSuccessHandler(function(res){
    showMessage(true, 'Success. Your referral has been sent to ' + res.buyerAgent + '.')
    clearValues() // clear values and dropdowns
    load() // reload data to bring in new referral
  })
  // if error
  .withFailureHandler(function(err){
    console.error("error occured", err);
    showMessage(false, 'Referral failed. Please try again.')
  })
  .submitReferral(buyerName, buyerPhone, buyerEmail, street, city, zip, notes, type, source)
}

function clearValues(){

  // reset values to empty strings
  document.getElementById('nameReferral').value = ''
  document.getElementById('phoneReferral').value = ''
  document.getElementById('emailReferral').value = ''
  document.getElementById('streetReferral').value = ''
  document.getElementById('cityReferral').value = ''
  document.getElementById('zipReferral').value = ''
  document.getElementById('notesReferral').value = ''
  
  // reset dropdowns to default
  document.getElementById('referralType').value = 0
  document.getElementById('source').value = 0
  
  // reset display of sourceElements to 'none'
  var e = document.getElementsByClassName('sourceElements')
  for (var i = 0; i < e.length; i++){
    e[i].style.display = 'none'
  }
}

</script>